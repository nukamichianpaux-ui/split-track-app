import React, { useState } from "react";
import { View, Text, StyleSheet, TouchableOpacity, SafeAreaView, TextInput, Switch } from "react-native";
import { Ionicons } from "@expo/vector-icons";
import { NavigationContainer, useNavigation } from "@react-navigation/native";
import { createNativeStackNavigator } from "@react-navigation/native-stack";

const Stack = createNativeStackNavigator();

const defaultTiles = [
  { id: "groceries", label: "Groceries", icon: "cart-outline" },
  { id: "dining", label: "Dining Out", icon: "restaurant-outline" },
  { id: "biggi", label: "Biggi Fun Money", icon: "cash-outline" },
  { id: "anna", label: "Anna Fun Money", icon: "cash-outline" },
  { id: "movies", label: "Movies", icon: "film-outline" },
  { id: "gas", label: "Gas", icon: "car-outline" },
  { id: "sinking", label: "Sinking Funds", icon: "archive-outline" },
  { id: "medication", label: "Medication", icon: "medkit-outline" },
  { id: "therapy", label: "Therapy", icon: "heart-outline" },
  { id: "tuition", label: "Tuition", icon: "school-outline" },
  { id: "np", label: "NP Appt", icon: "clipboard-outline" },
  { id: "household", label: "Household Supplies", icon: "home-outline" },
];

function HomeScreen({ navigation }) {
  return (
    <SafeAreaView style={homeStyles.safe}>
      <View style={homeStyles.screen}>
        <View style={homeStyles.grid}>
          {defaultTiles.map((t) => (
            <TouchableOpacity
              key={t.id}
              style={homeStyles.tile}
              activeOpacity={0.85}
              onPress={() => navigation.navigate("AddTransaction", { categoryLabel: t.label })}
            >
              <View style={homeStyles.iconBox}>
                <Ionicons name={t.icon} size={34} color="#29c7c9" />
              </View>
              <Text style={homeStyles.tileText}>{t.label}</Text>
            </TouchableOpacity>
          ))}
        </View>

        <TouchableOpacity
          style={homeStyles.fab}
          activeOpacity={0.85}
          onPress={() => navigation.navigate("AddTransaction", { categoryLabel: "" })}
        >
          <Ionicons name="add" size={28} color="#e7edf3" />
        </TouchableOpacity>

        <View style={homeStyles.bottomBar}>
          <TouchableOpacity
            style={homeStyles.tab}
            onPress={() => navigation.navigate("AddTransaction", { categoryLabel: "" })}
          >
            <Ionicons name="add-circle-outline" size={26} color="#29c7c9" />
          </TouchableOpacity>

          <TouchableOpacity style={homeStyles.tab} onPress={() => {}}>
            <Ionicons name="grid-outline" size={24} color="#cfd6de" />
          </TouchableOpacity>
          <TouchableOpacity style={homeStyles.tab} onPress={() => {}}>
            <Ionicons name="home-outline" size={24} color="#cfd6de" />
          </TouchableOpacity>
          <TouchableOpacity style={homeStyles.tab} onPress={() => {}}>
            <Ionicons name="cart-outline" size={24} color="#cfd6de" />
          </TouchableOpacity>
          <TouchableOpacity style={homeStyles.tab} onPress={() => {}}>
            <Ionicons name="menu-outline" size={24} color="#cfd6de" />
          </TouchableOpacity>
        </View>
      </View>
    </SafeAreaView>
  );
}

function AddTransactionScreen({ route }) {
  const navigation = useNavigation();
  const categoryLabel = route?.params?.categoryLabel ?? "";
  const [isExpense, setIsExpense] = useState(true);
  const [amount, setAmount] = useState("");
  const [notes, setNotes] = useState("");

  return (
    <SafeAreaView style={txStyles.safe}>
      <View style={txStyles.container}>
        <View style={txStyles.headerRow}>
          <TouchableOpacity onPress={() => navigation.goBack()} style={txStyles.headerIcon}>
            <Ionicons name="chevron-back" size={26} color="#cfd6de" />
          </TouchableOpacity>
          <Text style={txStyles.headerTitle}>Add transaction</Text>
          <View style={txStyles.headerRight}>
            <Ionicons name="notifications-outline" size={20} color="#cfd6de" />
            <Ionicons name="pricetag-outline" size={20} color="#cfd6de" style={{ marginLeft: 14 }} />
            <Ionicons name="sync-outline" size={20} color="#cfd6de" style={{ marginLeft: 14 }} />
          </View>
        </View>

        <View style={txStyles.row}>
          <Ionicons name="calendar-outline" size={20} color="#9aa5b1" />
          <Text style={txStyles.rowText}>Wed 31 Dec 25  04:50 am</Text>
        </View>

        <View style={txStyles.toggleRow}>
          <View style={txStyles.toggleItem}>
            <View style={[txStyles.dot, isExpense ? txStyles.dotOn : txStyles.dotOff]} />
            <Text style={txStyles.toggleText}>Expense</Text>
          </View>

          <Switch
            value={!isExpense}
            onValueChange={(v) => setIsExpense(!v)}
            thumbColor="#cfd6de"
            trackColor={{ false: "#2a2f35", true: "#2a2f35" }}
          />

          <View style={txStyles.toggleItem}>
            <View style={[txStyles.dot, !isExpense ? txStyles.dotOn : txStyles.dotOff]} />
            <Text style={txStyles.toggleText}>Income</Text>
          </View>
        </View>

        <Text style={txStyles.label}>Amount</Text>
        <View style={txStyles.inputRow}>
          <Text style={txStyles.currency}>$</Text>
          <TextInput
            value={amount}
            onChangeText={setAmount}
            placeholder=""
            placeholderTextColor="#7f8a96"
            keyboardType="numeric"
            style={txStyles.amountInput}
          />
          <View style={txStyles.calcBtn}>
            <Ionicons name="calculator-outline" size={18} color="#b8c2cc" />
          </View>
        </View>

        <Text style={txStyles.label}>Category</Text>
        <TouchableOpacity style={txStyles.categoryRow} activeOpacity={0.85} onPress={() => {}}>
          <View style={txStyles.catLeft}>
            <Ionicons name="nutrition-outline" size={22} color="#ff7a7a" />
            <Text style={txStyles.categoryText}>{categoryLabel || "Select category"}</Text>
          </View>
          <Ionicons name="chevron-forward" size={22} color="#9aa5b1" />
        </TouchableOpacity>

        <Text style={txStyles.label}>Notes (optional)</Text>
        <TextInput
          value={notes}
          onChangeText={setNotes}
          placeholder=""
          placeholderTextColor="#7f8a96"
          style={txStyles.notes}
          multiline
        />

        <TouchableOpacity style={txStyles.saveBtn} activeOpacity={0.85} onPress={() => {}}>
          <Text style={txStyles.saveText}>Save</Text>
        </TouchableOpacity>
      </View>
    </SafeAreaView>
  );
}

export default function App() {
  return (
    <NavigationContainer>
      <Stack.Navigator>
        <Stack.Screen name="Home" component={HomeScreen} options={{ headerShown: false }} />
        <Stack.Screen name="AddTransaction" component={AddTransactionScreen} options={{ headerShown: false }} />
      </Stack.Navigator>
    </NavigationContainer>
  );
}

const homeStyles = StyleSheet.create({
  safe: { flex: 1, backgroundColor: "#1f2328" },
  screen: { flex: 1, paddingHorizontal: 16, paddingTop: 84, paddingBottom: 24 },
  grid: { flex: 1, flexDirection: "row", flexWrap: "wrap", justifyContent: "space-between", alignContent: "flex-start", gap: 14, marginBottom: 24 },
  tile: { width: "48%", backgroundColor: "#3a3f46", borderRadius: 14, paddingVertical: 16, paddingHorizontal: 10, alignItems: "center" },
  iconBox: { width: 60, height: 60, borderRadius: 14, borderWidth: 1, borderColor: "#50575f", alignItems: "center", justifyContent: "center", backgroundColor: "#2a2f35", marginBottom: 10 },
  tileText: { fontSize: 13, color: "#e7edf3", textAlign: "center" },
  bottomBar: { height: 56, backgroundColor: "#2a2f35", borderRadius: 16, flexDirection: "row", justifyContent: "space-around", alignItems: "center", borderWidth: 1, borderColor: "#3a3f46" },
  tab: { width: 52, height: 44, alignItems: "center", justifyContent: "center" },
  fab: {
    position: "absolute",
    right: 18,
    bottom: 86,
    width: 56,
    height: 56,
    borderRadius: 18,
    backgroundColor: "#29c7c9",
    alignItems: "center",
    justifyContent: "center",
  },
});

const txStyles = StyleSheet.create({
  safe: { flex: 1, backgroundColor: "#1f2328" },
  container: { flex: 1, paddingHorizontal: 18, paddingTop: 26 },
  headerRow: { flexDirection: "row", alignItems: "center", justifyContent: "space-between", marginBottom: 18 },
  headerIcon: { width: 40, height: 40, alignItems: "center", justifyContent: "center" },
  headerTitle: { color: "#e7edf3", fontSize: 18 },
  headerRight: { flexDirection: "row", alignItems: "center" },
  row: { flexDirection: "row", alignItems: "center", marginBottom: 22 },
  rowText: { color: "#cfd6de", marginLeft: 10, fontSize: 16 },
  toggleRow: { flexDirection: "row", alignItems: "center", justifyContent: "space-between", marginBottom: 22 },
  toggleItem: { flexDirection: "row", alignItems: "center" },
  toggleText: { color: "#cfd6de", marginLeft: 10, fontSize: 16 },
  dot: { width: 18, height: 18, borderRadius: 9, borderWidth: 3 },
  dotOn: { borderColor: "#7b68ee", backgroundColor: "transparent" },
  dotOff: { borderColor: "#50575f", backgroundColor: "transparent" },
  label: { color: "#cfd6de", fontSize: 14, marginBottom: 10 },
  inputRow: { flexDirection: "row", alignItems: "center", backgroundColor: "#3a3f46", borderRadius: 16, paddingHorizontal: 14, height: 64, marginBottom: 22 },
  currency: { color: "#e7edf3", fontSize: 28, marginRight: 10 },
  amountInput: { flex: 1, color: "#e7edf3", fontSize: 22 },
  calcBtn: { width: 38, height: 38, borderRadius: 12, backgroundColor: "#4a4f57", alignItems: "center", justifyContent: "center" },
  categoryRow: { flexDirection: "row", alignItems: "center", justifyContent: "space-between", backgroundColor: "#3a3f46", borderRadius: 16, paddingHorizontal: 14, height: 64, marginBottom: 22 },
  catLeft: { flexDirection: "row", alignItems: "center" },
  categoryText: { color: "#e7edf3", marginLeft: 12, fontSize: 16 },
  notes: { backgroundColor: "#3a3f46", borderRadius: 16, paddingHorizontal: 14, paddingTop: 14, color: "#e7edf3", height: 92, marginBottom: 28 },
  saveBtn: { alignSelf: "center", backgroundColor: "#4a4f57", paddingHorizontal: 44, height: 52, borderRadius: 18, alignItems: "center", justifyContent: "center" },
  saveText: { color: "#b8c2cc", fontSize: 16 },
});

